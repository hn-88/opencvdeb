language: cpp

compiler:
  - gcc
  
before_install:
  - sudo apt-get update

install:

# OpenCV install code
# with inputs from
# https://stackoverflow.com/questions/54531215/how-to-install-opencv-4-on-travis-ci
  - sudo apt-get install -y build-essential
  - sudo apt-get install -y cmake git libgtk2.0-dev pkg-config libavcodec-dev libavformat-dev libswscale-dev
  - sudo apt-get install -y libtbb2 libtbb-dev libjpeg-dev libpng-dev libtiff-dev libjasper-dev libdc1394-22-dev

script:
  - git clone https://github.com/opencv/opencv
  - git checkout 4.3.0
  - cd opencv
  - mkdir build
  - cd build
  - cmake -D BUILD_EXAMPLES=OFF -D BUILD_TESTS=OFF -D BUILD_PERF_TESTS=OFF -D CMAKE_INSTALL_PREFIX=OpenCVLocal -D CPACK_BINARY_DEB=ON ..
  - cat CMakeCache.txt | grep CPACK_BINARY_DEB
  - make package
  
  # in case Github deploy fails
  - curl --upload-file Open*dev*.deb https://transfer.sh/OpenCV-4.3.0-dev.deb
  - curl --upload-file Open*libs*.deb https://transfer.sh/OpenCV-4.3.0-libs.deb
  
  
deploy:
  provider: releases
  token: $mytokenname
  file_glob: true
  file: OpenCV*.deb
  draft: true
  edge: true
